 cluster dibagi menjadi 2 namespace (staging dan production)

- untuk fornt end ganti yg berkaitan dengan axioss post dengan subdomain backend, cth api.tsubekti.my.id:4000/todos

kubectl create configMap mongodb-config-file --from-file=conf=mongodb.conf

resource "null_resource" "ec2-instance"{

  triggers = {
    instance_id= module.ec2-instance.id
  }
  
  connection {
    host = module.ec2-instance.public_ip
    user = "ubuntu"
    private_key = file("/home/tsubekti/Downloads/yono-aws-singapore.pem")
    type = "ssh"
  }

  provisioner "remote-exec" { 
  inline = [
    "sudo apt-get update -y",
    "sudo apt-get install python3 -y"
  ]
  }

  provisioner "local-exec" {
    working_dir = "/home/tsubekti/belajar/big-project/ansible-jenkins"
    command = "ansible-playbook main.yaml -i ${module.ec2-instance.public_ip}, -u ubuntu --private-key /home/tsubekti/Downloads/yono-aws-singapore.pem"
  }
}


//db.yaml
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app: mongodb
  name: mongodb
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mongodb
  strategy: {}
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: mongodb
    spec:
      containers:
      - image: mongo
        name: mongodb
        env:
        - name: MONGO_INITDB_ROOT_USERNAME
          valueFrom:
            secretKeyRef:
              name: mongodb-secret
              key: username
        - name: MONGO_INITDB_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mongodb-secret
              key: password
        volumeMounts:
        - name: "mongo-data-dir"
          mountPath: /data/db 
      volumes:
      - name: "mongo-data-dir"
        persistentVolumeClaim:
          claimName: mongodb-pv-claim
